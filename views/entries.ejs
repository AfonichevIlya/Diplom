<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

</head>




<body>
  
    <header> <%- include ('./partials/header') %></header>
    
  


    <div class="typewriter">
      <h4 id="typewriter-text"></h4>
      
      
      <% if (locals.user) { %>
        <div class="container" style="display: flex; flex-direction: row; min-height: 700px;">
          <div class="container33">
            <%- include ('./partials/menu') %>
          </div>
   
       <div class="container11" style="width: 50%; margin-left: 10%; margin-right:auto ;margin-bottom: 10%; 
       ">

         <form action="/post" method="post" enctype="multipart/form-data">
           <div class="mb-3 note-container">
             <input
             type="text"
             class="form-control"
             name="entry[title]"
             id="z"
             aria-describedby="helpId"
             placeholder="Заголовок"
             />
            </div>
            <div class="mb-3 note-container">
              <textarea
                placeholder="Текст заметки"
                class="form-control note-content"
                name="entry[content]"
                id="s"
                rows="4"
              ></textarea>
              <img id="noteImage" class="note-image" alt="Selected Image">
              <div class="file-input-container">
                <img src="../uploads/free-icon-photography-105724.png" alt="Upload Image Icon">
                <input type="file" id="image" name="image">
              </div>
              <div class="file-input-container">
                <img src="../uploads/free-icon-video-player-8518247.png" alt="Upload Video Icon">
                <input type="file" id="image" name="image">
              </div>
            </div>
          
            <button type="submit" value="Post" class="button-custom">
              Опубликовать
            </button>
          </form>
          
          <% entries.forEach((entry)=>{ %>
           
            <div class="card-body" style="">
              <h5 class="card-title"><%= entry.title %></h5>
              <p class="card-text">
                <%= entry.content %> 
              </p>
            </br>
            <% if(entry.image){ %>
              <img src="/images/<%= entry.image %>" alt="Post Image" style="min-width: 100%;">
              <% } %>
            </br>
            <div style="width: max-content; color: #f1cc9f;">
              <h6>Запостил: <%= entry.username %></h6>   
              <p><%= timeSince(entry.created_at) %></p> <!-- Здесь вызывается функция timeSince -->
          </div>
                     
            <% if(locals.user && locals.user.role === 'user' && entry.username === locals.user.name){ %>
              <button id="a3">
                <a href="/update/<%= entry.id %>" style="text-decoration: none; color: bisque;">
                  Изменить
                </a>
              </button>
              <button id="a2" class="btn-delete" data-id="<%=entry.id%>">
                Удалить
              </button>
              <% } %>
               </div>
               <% }) %> 
          </div> 
        </div>
        </br>
      </div>
            
         
          
          <script>
             document.getElementById('image').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const imgElement = document.getElementById('noteImage');
          imgElement.src = e.target.result;
          imgElement.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
            document.addEventListener('click', (e)=>{
              const id = e.target?.dataset?.id || null
              if(id){
                fetch(`/${id}`, {
                  method: 'DELETE'
                }).then(()=>{
                  window.location.reload()
                })
                
              }
            })
            
            </script>
          <% } else { %>
            <div id="typewriter2"><h5> Пожалуйста, войдите или зарегистрируйтесь, чтобы увидеть контент</h5></div>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                const typewriterText = document.getElementById('typewriter-text');
                const text = "Добро пожаловать в VibeCircle!  В VibeCircle мы не просто социальная платформа, мы движение, празднующее позитив, креативность и настоящие связи!";
                
                let index = 0;
                
                const cursor = document.createElement('span');
                cursor.className = 'cursor';
                cursor.textContent = '|';
                typewriterText.appendChild(cursor);
                
                function type() {
                  if (index < text.length) {
                    // Remove cursor before adding new character
                    typewriterText.removeChild(cursor);
                    // Add next character
                    typewriterText.textContent += text[index];
                    // Re-append cursor after new character
                    typewriterText.appendChild(cursor);
                    index++;
                    // Randomize the typing speed between 50ms and 150ms.
                    setTimeout(type, Math.random() * (40 - 10) + 30);
                  }
                }
                
  // Start typing
  type();
});

</script>

<% } %>
</body>
<footer> <%- include ('./partials/footer') %></footer>
</html>